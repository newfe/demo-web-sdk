<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Demo-web-sdk by newfe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Demo-web-sdk</h1>
      <h2 class="project-tagline">Demostration of Rong Web SDK.</h2>
      <a href="https://github.com/newfe/demo-web-sdk" class="btn">View on GitHub</a>
      <a href="https://github.com/newfe/demo-web-sdk/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/newfe/demo-web-sdk/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="demo-web-sdk" class="anchor" href="#demo-web-sdk" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>demo-web-sdk</h1>

<p>Demostration of Rong Web SDK.</p>

<h2>
<a id="融云-web-sdk-如何使用" class="anchor" href="#%E8%9E%8D%E4%BA%91-web-sdk-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>融云 Web SDK 如何使用</h2>

<p><a href="http://docs.rongcloud.cn/api/js/index.html" title=" SDK 文档">文档参考</a></p>

<p>使用融云 <code>Web SDK</code> 发消息之前必须利用申请的<code>appkey</code>进行初始化，只有在初始化之后才能使用RongIMClient.getInstance()方法得到实例.<br>
<em>如只想知晓如何使用 Web SDK 请参考 <code>SDK_Demo.html</code></em></p>

<h2>
<a id="指定版本号引用" class="anchor" href="#%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E5%8F%B7%E5%BC%95%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>指定版本号引用</h2>

<p><code>http://res.websdk.rongcloud.cn/RongIMClient-0.9.10.min.js</code> 历史版本号目前可从0.9.1到0.9.10。</p>

<blockquote>
<ul>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.1.min.js">0.9.1</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.2.min.js">0.9.2</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.3.min.js">0.9.3</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.4.min.js">0.9.4</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.5.min.js">0.9.5</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.6.min.js">0.9.6</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.7.min.js">0.9.7</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.8.min.js">0.9.8</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.9.min.js">0.9.9</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.10.min.js">0.9.10</a>
</li>
<li>  <a href="http://res.websdk.rongcloud.cn/RongIMClient-0.9.11.min.js">0.9.11</a>
</li>
</ul>
</blockquote>

<h4>
<a id="此事例中的代码皆为0910版本使用时请注意兼容性问题" class="anchor" href="#%E6%AD%A4%E4%BA%8B%E4%BE%8B%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E7%9A%86%E4%B8%BA0910%E7%89%88%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%97%B6%E8%AF%B7%E6%B3%A8%E6%84%8F%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>此事例中的代码皆为0.9.10版本，使用时请注意兼容性问题。</h4>

<h3>
<a id="初始化-web-sdk-此项必须设置" class="anchor" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-web-sdk-%E6%AD%A4%E9%A1%B9%E5%BF%85%E9%A1%BB%E8%AE%BE%E7%BD%AE" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>初始化 Web SDK ，此项必须设置</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">RongIMClient</span>.<span class="pl-en">init</span>(<span class="pl-s"><span class="pl-pds">"</span>appkey<span class="pl-pds">"</span></span>);</pre></div>

<h3>
<a id="设置链接状态监听器此项必须设置" class="anchor" href="#%E8%AE%BE%E7%BD%AE%E9%93%BE%E6%8E%A5%E7%8A%B6%E6%80%81%E7%9B%91%E5%90%AC%E5%99%A8%E6%AD%A4%E9%A1%B9%E5%BF%85%E9%A1%BB%E8%AE%BE%E7%BD%AE" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>设置链接状态监听器，此项必须设置</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">RongIMClient</span>.<span class="pl-en">setConnectionStatusListener</span>({  
     <span class="pl-en">onChanged</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">status</span>) {  
          <span class="pl-k">switch</span> (status) {
                <span class="pl-c">//链接成功</span>
                <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectionStatus</span>.<span class="pl-c1">CONNECTED</span><span class="pl-k">:</span>
                    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>链接成功<span class="pl-pds">'</span></span>);
                    <span class="pl-k">break</span>;
                <span class="pl-c">//正在链接</span>
                <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectionStatus</span>.<span class="pl-c1">CONNECTING</span><span class="pl-k">:</span>
                    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>正在链接<span class="pl-pds">'</span></span>);
                    <span class="pl-k">break</span>;
                <span class="pl-c">//重新链接</span>
                <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectionStatus</span>.<span class="pl-c1">RECONNECT</span><span class="pl-k">:</span>
                    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>重新链接<span class="pl-pds">'</span></span>);
                    <span class="pl-k">break</span>;
                <span class="pl-c">//其他设备登陆</span>
                <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectionStatus</span>.<span class="pl-c1">OTHER_DEVICE_LOGIN</span><span class="pl-k">:</span>
                <span class="pl-c">//连接关闭</span>
                <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectionStatus</span>.<span class="pl-c1">CLOSURE</span><span class="pl-k">:</span>
                <span class="pl-c">//未知错误</span>
                <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectionStatus</span>.<span class="pl-c1">UNKNOWN_ERROR</span><span class="pl-k">:</span>
                <span class="pl-c">//登出</span>
                <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectionStatus</span>.<span class="pl-c1">LOGOUT</span><span class="pl-k">:</span>
                <span class="pl-c">//用户已被封禁</span>
                <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectionStatus</span>.<span class="pl-c1">BLOCK</span><span class="pl-k">:</span>
                    <span class="pl-k">break</span>;
            }
     }  
}); </pre></div>

<h3>
<a id="链接融云服务器此项必须设置" class="anchor" href="#%E9%93%BE%E6%8E%A5%E8%9E%8D%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%AD%A4%E9%A1%B9%E5%BF%85%E9%A1%BB%E8%AE%BE%E7%BD%AE" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>链接融云服务器，此项必须设置</h3>

<p>此方法为异步方法，请确定链接成功之后再执行其他操作。成功返回登录人员id失败则返回失败枚举对象</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">RongIMClient</span>.<span class="pl-en">connect</span>(<span class="pl-s"><span class="pl-pds">"</span>token<span class="pl-pds">"</span></span>, {
     <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">userid</span>) {
         <span class="pl-c1">window</span>.<span class="pl-smi">console</span>.<span class="pl-en">log</span>(<span class="pl-s"><span class="pl-pds">"</span>connected，userid＝<span class="pl-pds">"</span></span> <span class="pl-k">+</span> userid)
     },
     <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">c</span>) {
          <span class="pl-k">var</span> info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>;
          <span class="pl-k">switch</span> (c) {
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">callback</span>.<span class="pl-smi">ErrorCode</span>.<span class="pl-c1">TIMEOUT</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>超时<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">callback</span>.<span class="pl-smi">ErrorCode</span>.<span class="pl-c1">UNKNOWN_ERROR</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>未知错误<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">UNACCEPTABLE_PROTOCOL_VERSION</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>不可接受的协议版本<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">IDENTIFIER_REJECTED</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>appkey不正确<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">SERVER_UNAVAILABLE</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>服务器不可用<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">TOKEN_INCORRECT</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>token无效<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">NOT_AUTHORIZED</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>未认证<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">REDIRECT</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>重新获取导航<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">PACKAGE_ERROR</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>包名错误<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">APP_BLOCK_OR_DELETE</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>应用已被封禁或已被删除<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">BLOCK</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>用户被封禁<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">TOKEN_EXPIRE</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>token已过期<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
               <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConnectErrorStatus</span>.<span class="pl-c1">DEVICE_ERROR</span><span class="pl-k">:</span>
                    info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>设备号错误<span class="pl-pds">'</span></span>;
                    <span class="pl-k">break</span>;
          }
          <span class="pl-en">console</span>.<span class="pl-c1">alert</span>(<span class="pl-s"><span class="pl-pds">"</span>失败:<span class="pl-pds">"</span></span> <span class="pl-k">+</span> info);
     }
});</pre></div>

<h3>
<a id="设置消息监听器此项必须设置" class="anchor" href="#%E8%AE%BE%E7%BD%AE%E6%B6%88%E6%81%AF%E7%9B%91%E5%90%AC%E5%99%A8%E6%AD%A4%E9%A1%B9%E5%BF%85%E9%A1%BB%E8%AE%BE%E7%BD%AE" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>设置消息监听器，此项必须设置</h3>

<p>所有接收的消息都通过此监听器进行处理，可以通过message.getMessageType()和RongIMClient.MessageType枚举对象来判断消息类型</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">RongIMClient</span>.<span class="pl-en">getInstance</span>().<span class="pl-en">setOnReceiveMessageListener</span>({
     <span class="pl-en">onReceived</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">message</span>) {
         <span class="pl-c">//message为RongIMMessage子类实例</span>
         <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">message</span>.<span class="pl-en">getContent</span>());
     }
});</pre></div>

<h3>
<a id="得到rongimclient实例对象只有执行init之后才能使用getinstance方法" class="anchor" href="#%E5%BE%97%E5%88%B0rongimclient%E5%AE%9E%E4%BE%8B%E5%AF%B9%E8%B1%A1%E5%8F%AA%E6%9C%89%E6%89%A7%E8%A1%8Cinit%E4%B9%8B%E5%90%8E%E6%89%8D%E8%83%BD%E4%BD%BF%E7%94%A8getinstance%E6%96%B9%E6%B3%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>得到RongIMClient实例对象,只有执行init()之后才能使用getInstance()方法</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> ins <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-en">getInstance</span>();</pre></div>

<h3>
<a id="设置私人会话类型" class="anchor" href="#%E8%AE%BE%E7%BD%AE%E7%A7%81%E4%BA%BA%E4%BC%9A%E8%AF%9D%E7%B1%BB%E5%9E%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>设置私人会话类型</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> contype <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConversationType</span>.<span class="pl-c1">PRIVATE</span>;</pre></div>

<h3>
<a id="例如注册某个元素点击事件举例" class="anchor" href="#%E4%BE%8B%E5%A6%82%E6%B3%A8%E5%86%8C%E6%9F%90%E4%B8%AA%E5%85%83%E7%B4%A0%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E4%B8%BE%E4%BE%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>例如注册某个元素点击事件(举例)</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">element</span>.<span class="pl-en">onclick</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {
<span class="pl-c">//调用实例的发送消息方法</span>
     <span class="pl-smi">ins</span>.<span class="pl-en">sendMessage</span>(contype, <span class="pl-s"><span class="pl-pds">"</span>targetId<span class="pl-pds">"</span></span>, <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">TextMessage</span>.<span class="pl-en">obtain</span>(<span class="pl-s"><span class="pl-pds">"</span>发送消息内容<span class="pl-pds">"</span></span>), <span class="pl-c1">null</span>, {
           <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> () {
                <span class="pl-c">//发送成功逻辑处理</span>
           },
           <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">x</span>) {
                <span class="pl-k">var</span> info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>;
                <span class="pl-k">switch</span> (x) {
                    <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">callback</span>.<span class="pl-smi">ErrorCode</span>.<span class="pl-c1">TIMEOUT</span><span class="pl-k">:</span>
                        info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>超时<span class="pl-pds">'</span></span>;
                        <span class="pl-k">break</span>;
                    <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">callback</span>.<span class="pl-smi">ErrorCode</span>.<span class="pl-c1">UNKNOWN_ERROR</span><span class="pl-k">:</span>
                        info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>未知错误<span class="pl-pds">'</span></span>;
                        <span class="pl-k">break</span>;
                    <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">SendErrorStatus</span>.<span class="pl-c1">REJECTED_BY_BLACKLIST</span><span class="pl-k">:</span>
                        info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>在黑名单中，无法向对方发送消息<span class="pl-pds">'</span></span>;
                        <span class="pl-k">break</span>;
                    <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">SendErrorStatus</span>.<span class="pl-c1">NOT_IN_DISCUSSION</span><span class="pl-k">:</span>
                        info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>不在讨论组中<span class="pl-pds">'</span></span>;
                        <span class="pl-k">break</span>;
                    <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">SendErrorStatus</span>.<span class="pl-c1">NOT_IN_GROUP</span><span class="pl-k">:</span>
                        info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>不在群组中<span class="pl-pds">'</span></span>;
                        <span class="pl-k">break</span>;
                    <span class="pl-k">case</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">SendErrorStatus</span>.<span class="pl-c1">NOT_IN_CHATROOM</span><span class="pl-k">:</span>
                        info <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>不在聊天室中<span class="pl-pds">'</span></span>;
                        <span class="pl-k">break</span>;
                    <span class="pl-k">default</span> <span class="pl-k">:</span>
                        info <span class="pl-k">=</span> x;
                        <span class="pl-k">break</span>;
                }
                <span class="pl-en">console</span>.<span class="pl-c1">alert</span>(<span class="pl-s"><span class="pl-pds">'</span>发送失败:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> info);
           }
       });
};</pre></div>

<h3>
<a id="同步会话列表此方法正处于调试阶段后期可能会有改动" class="anchor" href="#%E5%90%8C%E6%AD%A5%E4%BC%9A%E8%AF%9D%E5%88%97%E8%A1%A8%E6%AD%A4%E6%96%B9%E6%B3%95%E6%AD%A3%E5%A4%84%E4%BA%8E%E8%B0%83%E8%AF%95%E9%98%B6%E6%AE%B5%E5%90%8E%E6%9C%9F%E5%8F%AF%E8%83%BD%E4%BC%9A%E6%9C%89%E6%94%B9%E5%8A%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>同步会话列表(此方法正处于调试阶段，后期可能会有改动)</h3>

<p>在浏览器中使用融云<code>web SDK</code>与在移动端中使用融云<code>ios、安卓SDK</code>不同的是浏览器一刷新页面，之前已经存好的会话列表都将会清空。为了减少这种情况引起的麻烦，可以使用<code>RongIMClient.getInstance().syncConversationList()</code>方法，来同步的会话列表。这样的话，就不会因为刷新页面导致会话列表情况所引起的种种麻烦了。</p>

<div class="highlight highlight-source-js"><pre> <span class="pl-smi">RongIMClient</span>.<span class="pl-en">getInstance</span>().<span class="pl-en">syncConversationList</span>({
                        <span class="pl-en">onSuccess</span><span class="pl-k">:</span><span class="pl-k">function</span>(){
                            <span class="pl-c">//同步会话列表</span>
                            <span class="pl-c1">setTimeout</span>(<span class="pl-k">function</span>(){
                              <span class="pl-k">var</span> ConversationList <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-en">getInstance</span>().<span class="pl-en">getConversationList</span>();
                              <span class="pl-c">// do something</span>
                            },<span class="pl-c1">1000</span>);
                        },<span class="pl-en">onError</span><span class="pl-k">:</span><span class="pl-k">function</span>(){
                        }
                    });</pre></div>

<h3>
<a id="获取历史纪录此方法正处于调试阶段后期可能会有改动" class="anchor" href="#%E8%8E%B7%E5%8F%96%E5%8E%86%E5%8F%B2%E7%BA%AA%E5%BD%95%E6%AD%A4%E6%96%B9%E6%B3%95%E6%AD%A3%E5%A4%84%E4%BA%8E%E8%B0%83%E8%AF%95%E9%98%B6%E6%AE%B5%E5%90%8E%E6%9C%9F%E5%8F%AF%E8%83%BD%E4%BC%9A%E6%9C%89%E6%94%B9%E5%8A%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>获取历史纪录(此方法正处于调试阶段，后期可能会有改动)</h3>

<p>融云 <code>web SDK</code>最新提供<code>RongIMClient.getInstance().getHistoryMessages()</code>方法，来帮助开发者获取历史纪录。不再需要为如何在web端存储历史纪录而发愁。<em>使用此方法前提是APP必须<code>开启历史消息漫游(此接口为收费项目)</code>，如APP没有开启历史消息漫游则执行onError方法。</em></p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">// 此方法最多一次行拉取20条消息。拉取顺序按时间倒序拉取。</span>
<span class="pl-smi">RongIMClient</span>.<span class="pl-en">getInstance</span>().<span class="pl-en">getHistoryMessages</span>(<span class="pl-smi">RongIMClient</span>.<span class="pl-smi">ConversationType</span>.<span class="pl-c1">PRIVATE</span>,<span class="pl-s"><span class="pl-pds">'</span>targeid<span class="pl-pds">'</span></span>,<span class="pl-c1">10</span>,{
     <span class="pl-en">onSuccess</span><span class="pl-k">:</span><span class="pl-k">function</span>(<span class="pl-smi">symbol</span>,<span class="pl-smi">HistoryMessages</span>){
     <span class="pl-c">// symbol为boolean值，如果为true则表示还有剩余历史消息可拉取，为false的话表示没有剩余历史消息可供拉取。</span>
     <span class="pl-c">// HistoryMessages 为拉取到的历史消息列表</span>
     },<span class="pl-en">onError</span><span class="pl-k">:</span><span class="pl-k">function</span>(){
     <span class="pl-c">// APP未开启消息漫游或处理异常</span>
     <span class="pl-c">// throw new ERROR ......</span>
     }
})</pre></div>

<h3>
<a id="注册自定义消息" class="anchor" href="#%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>注册自定义消息</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-c">//注册一个自定义消息</span>
<span class="pl-smi">RongIMClient</span>.<span class="pl-en">registerMessageType</span>({messageType<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>EmptyMessage<span class="pl-pds">'</span></span>,objectName<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>s:empty<span class="pl-pds">'</span></span>,fieldName<span class="pl-k">:</span>[<span class="pl-s"><span class="pl-pds">'</span>Name<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>Age<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>Address<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>Occupation<span class="pl-pds">'</span></span>]});

<span class="pl-k">var</span> myMsg<span class="pl-k">=</span><span class="pl-k">new</span> <span class="pl-en">RongIMClient.EmptyMessage</span>({Name<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Jeams<span class="pl-pds">'</span></span>,Age<span class="pl-k">:</span><span class="pl-c1">32</span>,Address<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>beijing<span class="pl-pds">'</span></span>,Occupation<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Spy<span class="pl-pds">'</span></span>});

<span class="pl-smi">myMsg</span>.<span class="pl-en">getObjectName</span>(); <span class="pl-c">// =&gt; 's:empty' 根据此字段判断消息类型</span>

<span class="pl-smi">myMsg</span>.<span class="pl-en">getMessageType</span>(); <span class="pl-c">// =&gt; 'EmptyMessage' 消息名称</span>

<span class="pl-smi">myMsg</span>.<span class="pl-en">getMessageType</span>() <span class="pl-k">==</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">MessageType</span>.<span class="pl-smi">EmptyMessage</span>; <span class="pl-c">// =&gt; true 注册完消息类型之后 RongIMClient.MessageType 会自动添加一个自定义消息类型</span>

myMsg instanceOf <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">RongIMMessage</span>; <span class="pl-c">// =&gt; true 继承自融云消息基类</span>

<span class="pl-smi">myMsg</span>.<span class="pl-en">getDetail</span>(); <span class="pl-c">// =&gt; {Name:'Jeams',Age:32,Address:'beijing',Occupation:'Spy'} 得到消息体</span></pre></div>

<h3>
<a id="检测是否有未收到的消息" class="anchor" href="#%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%9C%89%E6%9C%AA%E6%94%B6%E5%88%B0%E7%9A%84%E6%B6%88%E6%81%AF" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>检测是否有未收到的消息</h3>

<p>融云目前的消息状态只有<code>送达</code>和<code>未送达</code>，没有<code>已读</code>和<code>未读</code>的状态。此接口用来查询是否有服务器<code>未送达</code>的消息。</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">//此接口可独立使用，不依赖init()和connect()方法。</span>
<span class="pl-smi">RongIMClient</span>.<span class="pl-en">hasUnreadMessages</span>(<span class="pl-s"><span class="pl-pds">'</span>APPKEY<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>TOKEN<span class="pl-pds">'</span></span>,{
    <span class="pl-en">onSuccess</span><span class="pl-k">:</span><span class="pl-k">function</span>(<span class="pl-smi">symbol</span>){
        <span class="pl-k">if</span>(symbol){
            <span class="pl-c">// 有未收到的消息</span>
        }<span class="pl-k">else</span>{
            <span class="pl-c">// 没有未收到的消息</span>
        }
    },<span class="pl-en">onError</span><span class="pl-k">:</span><span class="pl-k">function</span>(<span class="pl-smi">err</span>){
        <span class="pl-c">// 错误处理...</span>
    }
});</pre></div>

<h3>
<a id="兼容cmdamd等commonjs规范" class="anchor" href="#%E5%85%BC%E5%AE%B9cmdamd%E7%AD%89commonjs%E8%A7%84%E8%8C%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>兼容CMD、AMD等CommonJS规范</h3>

<p>融云<code>web SDK</code>从<code>0.9.9</code>版本起将开始支持seaJs和requireJs等模块加载器。</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">//以下代码仅以requireJs做示范</span>
<span class="pl-smi">require</span>.<span class="pl-en">config</span>({
    paths<span class="pl-k">:</span> {
        rongSDK<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>http://res.websdk.rongcloud.cn/RongIMClient-0.9.10.min<span class="pl-pds">'</span></span>
    }
});
<span class="pl-c1">require</span>([<span class="pl-s"><span class="pl-pds">'</span>rongSDK<span class="pl-pds">'</span></span>], <span class="pl-k">function</span>(<span class="pl-smi">RongIMClient</span>) {
    <span class="pl-c">//do something ...</span>
});
</pre></div>

<p>此外，也可以当作子模块引入。
<em>当引用seaJs或requireJs的时候<code>web SDK</code>内部会定义一个 <code>RongIMClient</code>模块。所以，当想把SDK当作子模块引入时，直接引用<code>RongIMClient</code>就可以了。</em></p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">define</span>(<span class="pl-s"><span class="pl-pds">"</span>modules_one<span class="pl-pds">"</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>RongIMClient<span class="pl-pds">'</span></span>], <span class="pl-k">function</span> (<span class="pl-smi">rong</span>) {
    <span class="pl-c">// do something ...</span>
});
<span class="pl-c1">require</span>([<span class="pl-s"><span class="pl-pds">'</span>modules_one<span class="pl-pds">'</span></span>],<span class="pl-k">function</span>(<span class="pl-smi">modules</span>){
   <span class="pl-c">//do something ... </span>
});</pre></div>

<p>使用<code>seaJs</code>进行模块加载</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">seajs</span>.<span class="pl-en">config</span>({
    alias<span class="pl-k">:</span> {
        rong<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>http://res.websdk.rongcloud.cn/RongIMClient-0.9.9.min<span class="pl-pds">'</span></span>
    }
});
<span class="pl-smi">seajs</span>.<span class="pl-en">use</span>([<span class="pl-s"><span class="pl-pds">'</span>rong<span class="pl-pds">'</span></span>], <span class="pl-k">function</span> () {
     <span class="pl-c">//do something ...</span>
});</pre></div>

<h3>
<a id="web-sdk-浏览器兼容性" class="anchor" href="#web-sdk-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Web SDK 浏览器兼容性</h3>

<div class="highlight highlight-source-js"><pre>
 <span class="pl-c">//PC side</span>
 <span class="pl-c">//-----------------------------------------------------------------------------------------</span>
 <span class="pl-c">//|Desktop Feature| Chrome | Firefox (Gecko) | Internet Explorer | Opera | Safari (WebKit)|</span>
 <span class="pl-c">//----------------------------------------------------------------------------------------</span>
 <span class="pl-c">//|Basic support  |   3    |     3.5         |          6        |   12  |        4       |</span>
 <span class="pl-c">//-----------------------------------------------------------------------------------------</span>

 <span class="pl-c">//mobile side</span>
 <span class="pl-c">//-----------------------------------------------------------------------------------------------------------------</span>
 <span class="pl-c">//|Mobile Feature| Android | Chrome for Android | Firefox Mobile (Gecko) | IE Phone | Opera Mobile | Safari Mobile|</span>
 <span class="pl-c">//-----------------------------------------------------------------------------------------------------------------</span>
 <span class="pl-c">//|Basic support |     ?   |     0.16  (Yes)    |          ?             |     ?    |     ?        |      ?       |  </span>
 <span class="pl-c">//-----------------------------------------------------------------------------------------------------------------</span>
</pre></div>

<h3>
<a id="使用指定链接通道链接服务器" class="anchor" href="#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E9%93%BE%E6%8E%A5%E9%80%9A%E9%81%93%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用指定链接通道链接服务器</h3>

<p>Web SDK 通道采用层层降级的方式进行兼容处理。连接通道首先默认使用websocket，如环境不支持websocket则自动降级至 Flash socket，不支持 Flash 则自定降级至 xhr-polling，以此来达到全兼容的目的。
<br>
如果想强制使用长链接连接服务器则必须设置<code>window.WEB_XHR_POLLING = true;</code></p>

<h4>
<a id="通道选项设置使用此项必须为096版本使用前请确定sdk版本号为096及以上版本" class="anchor" href="#%E9%80%9A%E9%81%93%E9%80%89%E9%A1%B9%E8%AE%BE%E7%BD%AE%E4%BD%BF%E7%94%A8%E6%AD%A4%E9%A1%B9%E5%BF%85%E9%A1%BB%E4%B8%BA096%E7%89%88%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%89%8D%E8%AF%B7%E7%A1%AE%E5%AE%9Asdk%E7%89%88%E6%9C%AC%E5%8F%B7%E4%B8%BA096%E5%8F%8A%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>通道选项设置[使用此项必须为0.9.6版本,使用前请确定SDK版本号为0.9.6及以上版本]</h4>

<div class="highlight highlight-source-js"><pre>     <span class="pl-c">//强制使用长链接进行通讯 设置此项，并保证此项优先级最高并且最先被执行，否则设置无效</span>
     <span class="pl-c1">window</span>.<span class="pl-c1">WEB_XHR_POLLING</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</pre></div>

<div class="highlight highlight-source-js"><pre>     <span class="pl-c">//强制使用flash进行通讯 设置此项，并保证此项优先级最高并且最先被执行，否则设置无效</span>
     <span class="pl-c1">window</span>.<span class="pl-c1">WEB_SOCKET_FORCE_FLASH</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</pre></div>

<h2>
<a id="通道选项优先级比较" class="anchor" href="#%E9%80%9A%E9%81%93%E9%80%89%E9%A1%B9%E4%BC%98%E5%85%88%E7%BA%A7%E6%AF%94%E8%BE%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>通道选项优先级比较</h2>

<p><code>window.WEB_SOCKET_FORCE_FLASH &gt; window.WEB_XHR_POLLING</code></p>

<h3>
<a id="使用指定存储" class="anchor" href="#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E5%AD%98%E5%82%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用指定存储</h3>

<p>强制使用localstorage存储SDK标识数据，主要用来兼容Hybrid应用。
<em>(ps:在Hybrid应用中无法使用Cookie功能，导致SDK程序异常。可使用此选项，将标志数据存储到localstorage中。)</em></p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-c">//兼容Hybrid应用，可设置此项</span>
     <span class="pl-c1">window</span>.<span class="pl-c1">FORCE_LOCAL_STORAGE</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</pre></div>

<h4>
<a id="注意" class="anchor" href="#%E6%B3%A8%E6%84%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>注意:</h4>

<p>1 : <code>Web SDK</code> 是全异步的，所以发送消息之前确保链接成功。<br>
 2 : 本demo仅做演示使用，页面不做兼容性考虑。<br>
 3 : 本<code>Web SDK</code>为强兼容性，demo的弱兼容性与SDK无关。<br>
 4 : 使用本示例的页面在商业上使用而引发的处理不当与本人以及本人所属组织无关。<br>
 5 : 本示例仅做演示，仅仅只做演示。未考虑低版本及部分版本浏览器兼容性。<br>
 6 : 浏览器兼容性项中未列出的浏览器版本项皆为不支持的浏览器版本</p>

<h3>
<a id="须知" class="anchor" href="#%E9%A1%BB%E7%9F%A5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>须知</h3>

<p>本Demo需配合<code>demo server</code>一起使用。<a href="https://github.com/rongcloud/demo-server-php">Demo Server</a></p>

<hr>

<h2>
<a id="表情帮助库如何使用" class="anchor" href="#%E8%A1%A8%E6%83%85%E5%B8%AE%E5%8A%A9%E5%BA%93%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>表情帮助库如何使用？</h2>

<p><code>http://res.websdk.rongcloud.cn/RongIMClient.emoji-0.9.2.min.js</code> 融云官方表情帮助库引用地址。本表情库使用的是标准的 <code>emoji</code> 表情。本表情库一共有128个表情,默认为为22px＊22px。表情库是基于 <code>Web SDK</code> 的，使用之前请务必提前载入 <code>Web SDK</code>.表情库中的方法均为<code>静态方法</code>.由于部分浏览器显示本表情的 <code>tag</code> 为一个小方块。无法得到内容。此处可用escape()方法得到表情 <code>tag</code> </p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\u</span>d83d<span class="pl-cce">\u</span>de00<span class="pl-pds">'</span></span>);
     <span class="pl-c">//例如chrome中显示 \ud83d\ude00 为一个小方块，可用escape()方法</span>
     <span class="pl-k">var</span> str <span class="pl-k">=</span> <span class="pl-c1">escape</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\u</span>d83d<span class="pl-cce">\u</span>de00<span class="pl-pds">'</span></span>);
     <span class="pl-en">console</span>.<span class="pl-c1">log</span>(str);
     <span class="pl-c">//返回％ud83d％ude00，将％替换为\既是表情的 tag 属性</span>

     <span class="pl-c">//表情对象的格式为</span>
     <span class="pl-k">var</span> emojiObject<span class="pl-k">=</span>{
          englishName<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>表情英文名称<span class="pl-pds">'</span></span>,
          chineseName<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>表情中文名称<span class="pl-pds">'</span></span>,
          img<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>一个nodeName为B的HTMLElement元素，背景为表情图片<span class="pl-pds">'</span></span>,
          tag<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>表情的标签，为一组unicode码<span class="pl-pds">'</span></span>
     }</pre></div>

<h4>
<a id="rongimclientexpressiongetallexpression" class="anchor" href="#rongimclientexpressiongetallexpression" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.Expression.getAllExpression</h4>

<p>得到指定数量的表情</p>

<div class="highlight highlight-source-js"><pre> <span class="pl-k">var</span> emojiObjectList <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">Expression</span>.<span class="pl-en">getAllExpression</span>(<span class="pl-c1">64</span>,<span class="pl-c1">0</span>);
  <span class="pl-c">//从下标为0的位置检索64个表情对象,startIndex与count只和最大为128，因为表情对象最多为128个。</span>
  <span class="pl-k">for</span>(<span class="pl-k">var</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>,item;item<span class="pl-k">=</span>emojiObjectList[i<span class="pl-k">++</span>];){
     <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">item</span>.<span class="pl-smi">englishName</span>,<span class="pl-smi">item</span>.<span class="pl-smi">chineseName</span>,<span class="pl-smi">item</span>.<span class="pl-smi">img</span>,<span class="pl-smi">item</span>.<span class="pl-smi">tag</span>);
     <span class="pl-c">//依次打印表情元素</span>
  }</pre></div>

<h4>
<a id="rongimclientexpressiongetemojibycontent" class="anchor" href="#rongimclientexpressiongetemojibycontent" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.Expression.getEmojiByContent</h4>

<p>根据表情的 <code>content</code> ( <code>content</code> 为一个UTF16码，可根据表情对象 <code>tag</code> 属性计算得到此UTF16码)来得到表情对象</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-k">var</span> emojiObject <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">Expression</span>.<span class="pl-en">getEmojiByContent</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\u</span>1F600<span class="pl-pds">'</span></span>);
     <span class="pl-c">//如果传入的不是合法UTF16码或者表情名单中不存在此UTF16码则返回 undeined </span>
     <span class="pl-en">console</span>.<span class="pl-c1">log</span>(emojiObject);</pre></div>

<h4>
<a id="rongimclientexpressioncalcutf" class="anchor" href="#rongimclientexpressioncalcutf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.Expression.calcUTF</h4>

<p>根据表情的 <code>content</code> 计算得到表情的 <code>tag</code> 属性</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-k">var</span> tag <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">Expression</span>.<span class="pl-en">calcUTF</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\u</span>1F600<span class="pl-pds">'</span></span>);
     <span class="pl-en">console</span>.<span class="pl-c1">log</span>(tag);
     <span class="pl-c">//返回\ud83d\ude00 即将 \u1F600 计算为 \ud83d\ude00</span></pre></div>

<h4>
<a id="rongimclientexpressiongetemojiobjbyenglishnameorchinesename" class="anchor" href="#rongimclientexpressiongetemojiobjbyenglishnameorchinesename" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.Expression.getEmojiObjByEnglishNameOrChineseName</h4>

<p>根据表情的中文名称或者英文名称得到表情对象</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-k">var</span> emojiObject <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">Expression</span>.<span class="pl-en">getEmojiObjByEnglishNameOrChineseName</span>(<span class="pl-s"><span class="pl-pds">"</span>足球<span class="pl-pds">"</span></span>);
     <span class="pl-en">console</span>.<span class="pl-c1">log</span>(emojiObject);</pre></div>

<h4>
<a id="rongimclientexpressionretrievalemoji" class="anchor" href="#rongimclientexpressionretrievalemoji" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.Expression.retrievalEmoji</h4>

<p>检索传入的字符串中是否含有表情 <code>tag</code>，如有则根据传入的callback函数执行制定操作,callback函数中 <code>务必带返回值</code> </p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-k">var</span> str <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">Expression</span>.<span class="pl-en">retrievalEmoji</span>(<span class="pl-s"><span class="pl-pds">'</span>这是一个表情<span class="pl-cce">\u</span>d83d<span class="pl-cce">\u</span>de00<span class="pl-pds">'</span></span>,<span class="pl-k">function</span>(<span class="pl-smi">emojiObject</span>){
          <span class="pl-en">console</span>.<span class="pl-c1">log</span>(emojiObject);
          <span class="pl-k">return</span> <span class="pl-smi">emojiObject</span>.<span class="pl-smi">chineseName</span>;
     });
     <span class="pl-en">console</span>.<span class="pl-c1">log</span>(str);
     <span class="pl-c">//打印为 这是一个表情狞笑</span>
</pre></div>

<h3>
<a id="浏览器兼容性" class="anchor" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>浏览器兼容性</h3>

<div class="highlight highlight-source-js"><pre> <span class="pl-c">// IE 6+ 、chrome 3+ 、firefox 3.5+ 、safari 4+ 、 opera 12+</span></pre></div>

<hr>

<h2>
<a id="音频播放帮助库如何使用" class="anchor" href="#%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE%E5%B8%AE%E5%8A%A9%E5%BA%93%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>音频播放帮助库如何使用？</h2>

<p><code>http://res.websdk.rongcloud.cn/RongIMClient.voice-0.9.1.min.js</code> 融云官方音频播放帮助库引用地址.音频播放帮助库是基于 <code>Web SDK</code> 的，使用之前请务必提前载入 <code>Web SDK</code>.音频播放帮助库中的方法均为<code>静态方法</code>.与<code>IE</code>以及<code>opera</code>内核类型浏览器不兼容。</p>

<h4>
<a id="rongimclientvoiceinit" class="anchor" href="#rongimclientvoiceinit" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.voice.init</h4>

<p>初始化音频播放帮助库,使用本库之前务必进行初始化操作，返回为 <code>boolean</code> 类型用来说明次音频库是否已经初始化完成</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-k">var</span> isInit <span class="pl-k">=</span> <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">voice</span>.<span class="pl-en">init</span>();
     <span class="pl-en">console</span>.<span class="pl-c1">log</span>(isInit);
     <span class="pl-c">//可以根据isInit来判断是否已经初始化完成</span></pre></div>

<h4>
<a id="rongimclientvoiceplay" class="anchor" href="#rongimclientvoiceplay" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.voice.play</h4>

<p>播放传入的格式为AMR的音频BASE64码</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">voice</span>.<span class="pl-en">play</span>(<span class="pl-s"><span class="pl-pds">'</span>格式为AMR的音频BASE64码<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>音频持续时间(秒)<span class="pl-pds">'</span></span>);
     <span class="pl-c">//如果不知道音频的持续时间，可通过音频base64长度除以1024得到大概秒数</span></pre></div>

<h4>
<a id="rongimclientvoiceonprogress" class="anchor" href="#rongimclientvoiceonprogress" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.voice.onprogress</h4>

<p>音频播放过程中执行的进度方法,需自行注册.</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">voice</span>.<span class="pl-smi">onprogress</span> ＝ <span class="pl-k">function</span>(){
          <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>正在执行<span class="pl-pds">"</span></span>);
     };
     <span class="pl-c">//执行单位时间为一秒执行一次</span></pre></div>

<h3>
<a id="浏览器兼容性-1" class="anchor" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>浏览器兼容性</h3>

<div class="highlight highlight-source-js"><pre> <span class="pl-c">//pc :     Firefox (Gecko) 3.6 (1.9.2)+     Chrome 7+   Safari 6.0.2+</span>
 <span class="pl-c">//mobile :  Firefox (Gecko) 32+     Android 3+  Safari 6.1+</span></pre></div>

<hr>

<h2>
<a id="web-端本地存储帮助库如何使用" class="anchor" href="#web-%E7%AB%AF%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E5%B8%AE%E5%8A%A9%E5%BA%93%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Web 端本地存储帮助库如何使用？</h2>

<p><code>http://res.websdk.rongcloud.cn/RongIMClient.indexedDB.min.js</code> 融云官方 Web 端本地存储帮助库引用地址. Web 端本地存储帮助库是基于 <code>indexed DB</code> 的，使用之前请务必确保提前载入 <code>Web SDK</code> 和当前浏览器支持 <code>indexed DB</code> . Web 端本地存储帮助库中的方法均为<code>静态方法</code>.</p>

<h4>
<a id="rongimclientindexeddbgetmessagelistfromindexeddb" class="anchor" href="#rongimclientindexeddbgetmessagelistfromindexeddb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.indexedDB.getMessageListFromIndexedDB</h4>

<p>得到本地之前存储的消息对象列表.</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">indexedDB</span>.<span class="pl-en">getMessageListFromIndexedDB</span>(<span class="pl-k">function</span>(<span class="pl-smi">msgList</span>){
          <span class="pl-en">console</span>.<span class="pl-c1">log</span>(msgList);
     });</pre></div>

<h4>
<a id="rongimclientindexeddbaddmessagetoindexeddb" class="anchor" href="#rongimclientindexeddbaddmessagetoindexeddb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.indexedDB.addMessageToIndexedDB</h4>

<p>将消息对象添加到本地存储.</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-k">var</span> msg<span class="pl-k">=</span><span class="pl-smi">RongIMClient</span>.<span class="pl-smi">TextMessage</span>.<span class="pl-en">obtain</span>(<span class="pl-s"><span class="pl-pds">"</span>this is a demo<span class="pl-pds">"</span></span>);
     <span class="pl-smi">msg</span>.<span class="pl-en">setMessageId</span>(<span class="pl-c1">Math</span>.<span class="pl-c1">random</span>());
     <span class="pl-k">var</span> messageId<span class="pl-k">=</span><span class="pl-smi">msg</span>.<span class="pl-en">getMessageId</span>();
     <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">indexedDB</span>.<span class="pl-en">addMessageToIndexedDB</span>(msg,<span class="pl-k">function</span>(){
          <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>add success<span class="pl-pds">'</span></span>);
     });</pre></div>

<h4>
<a id="rongimclientindexeddbdeletemessagefromindexeddb" class="anchor" href="#rongimclientindexeddbdeletemessagefromindexeddb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.indexedDB.deleteMessageFromIndexedDB</h4>

<p>根据消息标识id把指定消息对象从本地存储删除.</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">indexedDB</span>.<span class="pl-en">deleteMessageFromIndexedDB</span>(messageId,<span class="pl-k">function</span>(){
          <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>delete success<span class="pl-pds">'</span></span>);
     });</pre></div>

<h4>
<a id="rongimclientindexeddbgetmessagelistcountfromindexeddb" class="anchor" href="#rongimclientindexeddbgetmessagelistcountfromindexeddb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RongIMClient.indexedDB.getMessageListCountFromIndexedDB</h4>

<p>得到本地存储的消息对象列表长度.</p>

<div class="highlight highlight-source-js"><pre>     <span class="pl-smi">RongIMClient</span>.<span class="pl-smi">indexedDB</span>.<span class="pl-en">getMessageListCountFromIndexedDB</span>(<span class="pl-k">function</span>(<span class="pl-smi">count</span>){
          <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>length : <span class="pl-pds">'</span></span> <span class="pl-k">+</span> count);
     });</pre></div>

<h3>
<a id="浏览器兼容性-2" class="anchor" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>浏览器兼容性</h3>

<div class="highlight highlight-source-js"><pre> <span class="pl-c">//pc :     Firefox (Gecko) 4 (2)+     Chrome 12+  Internet Explorer 10+</span>
 <span class="pl-c">//mobile :  Firefox (Gecko) 6+</span></pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/newfe/demo-web-sdk">Demo-web-sdk</a> is maintained by <a href="https://github.com/newfe">newfe</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
